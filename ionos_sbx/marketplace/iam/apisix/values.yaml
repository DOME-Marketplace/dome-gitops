apisix:
  controlPlane:
    enabled: true
    # -- resource preset to small to have sufficient memory
    resourcesPreset: small
  ingressController:
    # -- not required, since ingress happens through the nginx
    enabled: false
  # -- configuration in regard to the apisix etcd
  etcd:
    # -- should it be enabled
    enabled: true
  # -- configuration in regard to the apisix dataplane
  dataPlane:
    # -- resource preset to have sufficient memory
    resourcesPreset: small
    extraConfig:
      deployment:
        # -- allows to configure apisix through a yaml file
        role_data_plane:
          config_provider: yaml
  # -- configuration in regard to the apisix dashboard
  dashboard:
    # -- configure consumers and there keys
    enabled: true
    # -- resource preset to small to have sufficient memory
    resourcesPreset: small
    # -- initial auth config
    username: "admin"
    existingSecret: apisix-secret
    existingSecretPasswordKey: adminPassword
    # -- should be terminated at the edge
    tls:
      enabled: false
      autoGenerated: false
    service:
      type: ClusterIP
    # -- configure ingress and tls through the ingress-controller
    ingress:
      enabled: true
      hostname: apisix.dome-marketplace-sbx.org
      ingressClassName: nginx
      tls: true
      pathType: Prefix
      annotations: 
        cert-manager.io/cluster-issuer: letsencrypt-sbx-issuer
  # -- we need `routes` to declaratively configure the routes
  extraVolumes:
    - name: routes
      configMap:
        name: apisix-routes
  extraVolumeMounts:
    - name: routes
      mountPath: /usr/local/apisix/conf/apisix.yaml
  # -- configure the routes to be made available with the api-key plugin enabled. Keys then need to be assigned through the dashboard
  routes:
    - uri: /party-catalog
      methods: ["GET"]
      upstream:
        nodes:
            http://tmforum-party-catalog:8080: 1
        type: roundrobin
      plugins:
        key-auth:
          header: api-key
    - uri: /customer-bill-management
      methods: ["GET"]
      upstream:
        nodes:
            http://tmforum-customer-bill-management:8080: 1
        type: roundrobin
      plugins:
        key-auth:
          header: api-key
    - uri: /product-catalog
      methods: ["GET"]
      upstream:
        nodes:
            http://tmforum-product-catalog:8080: 1
        type: roundrobin
      plugins:
        key-auth:
          header: api-key
    - uri: /product-inventory
      methods: ["GET"]
      upstream:
        nodes:
            http://tmforum-product-inventory:8080: 1
        type: roundrobin
      plugins:
        key-auth:
          header: api-key
    - uri: /product-ordering-management
      methods: ["GET"]
      upstream:
        nodes:
            http://tmforum-product-ordering-management:8080: 1
        type: roundrobin
      plugins:
        key-auth:
          header: api-key
    - uri: /resource-catalog
      methods: ["GET"]
      upstream:
        nodes:
            http://tmforum-resource-catalog:8080: 1
        type: roundrobin
    - uri: /resource-function-activation
      methods: ["GET"]
      upstream:
        nodes:
            http://tmforum-resource-function-activation:8080: 1
        type: roundrobin
      plugins:
        key-auth:
          header: api-key
    - uri: /resource-inventory
      methods: ["GET"]
      upstream:
        nodes:
            http://tmforum-resource-inventory:8080: 1
        type: roundrobin
      plugins:
        key-auth:
          header: api-key
    - uri: /service-catalog
      methods: ["GET"]
      upstream:
        nodes:
            http://tmforum-service-catalog:8080: 1
        type: roundrobin
    - uri: /account
      methods: ["GET"]
      upstream:
        nodes:
            http://tmforum-account:8080: 1
        type: roundrobin
      plugins:
        key-auth:
          header: api-key
    - uri: /agreement
      methods: ["GET"]
      upstream:
        nodes:
            http://tmforum-agreement:8080: 1
        type: roundrobin
      plugins:
        key-auth:
          header: api-key
    - uri: /usage-management
      methods: ["GET"]
      upstream:
        nodes:
            http://tmforum-usage-management:8080: 1
        type: roundrobin
      plugins:
        key-auth:
          header: api-key